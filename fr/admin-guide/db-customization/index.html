

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.5. Personnalisation du modèle de données &mdash; Documentation TWW dev</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=7ab3649f" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=b46de64f"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/translations.js?v=041d0952"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="4.6. Data model tool" href="../datamodel-tool/index.html" />
    <link rel="prev" title="4.4. Échange de données INTERLIS" href="../interlis-io/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TWW
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../features-guide/index.html">1. TEKSI Assainissement (TWW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation-guide/index.html">2. TWW Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">3. TWW User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">4. Guide d’administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../datamodel.html">4.1. Datamodel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pgadmin/index.html">4.2. pgAdmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">4.3. User Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interlis-io/index.html">4.4. Échange de données INTERLIS</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.5. Personnalisation du modèle de données</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.5.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#altering-symbology-and-labelling-behaviour">4.5.2. Altering symbology and labelling behaviour</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-fields">4.5.3. Ajouter des champs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joining-additional-tables">4.5.4. Joindre des tables additionnelles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-views">4.5.5. Créer des vues personnalisées</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../datamodel-tool/index.html">4.6. Data model tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db-update-pum/index.html">4.7. Manual update of the datamodel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extensions-guide/index.html">5. Official TWW extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tww_swmm/index.html">6. SWMM Data Exchange</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation/index.html">7. Traduction</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TWW</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">4. </span>Guide d’administration</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4.5. </span>Personnalisation du modèle de données</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/admin-guide/db-customization/index.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div></div></blockquote>
<section id="customization-of-the-data-model">
<h1><span class="section-number">4.5. </span>Personnalisation du modèle de données<a class="headerlink" href="#customization-of-the-data-model" title="Lien vers cette rubrique"></a></h1>
<p>Ce chapître décrit les personnalisations possibles du modèle de données.</p>
<section id="introduction">
<h2><span class="section-number">4.5.1. </span>Introduction<a class="headerlink" href="#introduction" title="Lien vers cette rubrique"></a></h2>
<p>Le modèle de données est versionné et mis à jour à l’aide du Postgres Updates Manager (abr. <a class="reference external" href="https://github.com/opengisch/pum">PUM</a>). Les vues requises pour l’édition des données sont générées automatiquement en utilisant la <a class="reference external" href="https://github.com/opengisch/pirogue">librairie Pirogue</a>.</p>
<p>La combinaison des deux rend possible l’introduction de petites personnalisations du modèle de données comme l’ajout de champs aux tables existantes ou l’extension de vues par jointure de tables additionnelles.</p>
<p>Before going further, we strongly recommend to ask the community if you have any doubts about how to store any information in the database. TWW complies with <a class="reference external" href="http://www.sia.ch/405">SIA 405</a> Waste Water and <a class="reference external" href="http://dss.vsa.ch">VSA-DSS</a> datamodel.</p>
<p>If TWW data model is not able yet to hold some data, please let us know what kind and how it should be handled. TWW data model is a standard proof adaptative model and could follow your needs.</p>
<p>If a customization is still required, the following explanations and rules explain how to adapt TWW data model to your specific needs.</p>
</section>
<section id="altering-symbology-and-labelling-behaviour">
<h2><span class="section-number">4.5.2. </span>Altering symbology and labelling behaviour<a class="headerlink" href="#altering-symbology-and-labelling-behaviour" title="Lien vers cette rubrique"></a></h2>
<p>Symbology and labelling behaviour depends on the value lists `` tww_vl.channel_usage_current`` and `` tww_vl.channel_function_hierarchic``  These two value list tables have an additional column <code class="docutils literal notranslate"><span class="pre">tww_symbology_order</span></code>, which is used to define the hierarchy of the symbology.</p>
<p>For labelling, one can use the column `` tww_vl.channel_function_hierarchic.tww_use_in_labels`` to define which functions_hierarchic are taken into account when creating a wastewater structure’s label.</p>
</section>
<section id="adding-fields">
<h2><span class="section-number">4.5.3. </span>Ajouter des champs<a class="headerlink" href="#adding-fields" title="Lien vers cette rubrique"></a></h2>
<p>Il est autorisé d’ajouter des champs additionnels aux tables en les nommant avec le préfixe <code class="docutils literal notranslate"><span class="pre">usr_…</span></code>.</p>
<p>If added in base tables, these additional fields will be automatically added to the views, being an editable field. The views can be re-generated any time using the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_tww</span> <span class="pre">--srid</span> <span class="pre">2056</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When running data model upgrades using PUM, it will be required to use the additional option <code class="docutils literal notranslate"><span class="pre">--exclude-field-pattern</span> <span class="pre">'usr_%'</span></code></p>
</div>
</section>
<section id="joining-additional-tables">
<h2><span class="section-number">4.5.4. </span>Joindre des tables additionnelles<a class="headerlink" href="#joining-additional-tables" title="Lien vers cette rubrique"></a></h2>
<p>It is possible to join additional tables to the two main views (<code class="docutils literal notranslate"><span class="pre">vw_tww_wastewater_structure</span></code> and <code class="docutils literal notranslate"><span class="pre">vw_tww_reach</span></code>).
This is done by using a YAML definition file for each view and defining a list of joined tables.
Fields of these tables will be joined as read-only fields as they are discarded in edit triggers.
For joining a table to <code class="docutils literal notranslate"><span class="pre">tww_od.wastewater_structure</span></code>, here is an example:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">joins</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my_extra_join</span><span class="p">:</span>
<span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tww_od.my_table</span>
<span class="w">    </span><span class="nt">alias</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mt</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mt_</span>
<span class="w">    </span><span class="nt">skip_columns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">field_1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">field_2</span>
<span class="w">    </span><span class="nt">remap_columns</span><span class="p">:</span>
<span class="w">      </span><span class="nt">field_3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_renamed_field</span>
<span class="w">    </span><span class="nt">join_on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mt.fk_ws = ws.obj_id</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">table</span></code> et <code class="docutils literal notranslate"><span class="pre">join_on</span></code> sont les clés obligatoires, les autres sont optionnelles.</p>
<p>Ce fichier YAML doit recevoir le chemin du fichier au lancement du script :</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_tww</span> <span class="pre">--srid</span> <span class="pre">2056</span> <span class="pre">--tww_wastewater_structure_extra</span> <span class="pre">/path_to/extra_ws.yaml</span></code></p>
<p>And similarly for <code class="docutils literal notranslate"><span class="pre">vw_tww_reach</span></code> view, by specifying <code class="docutils literal notranslate"><span class="pre">tww_reach_extra</span></code> variable to the corresponding YAML file path.</p>
</section>
<section id="creating-custom-views">
<h2><span class="section-number">4.5.5. </span>Créer des vues personnalisées<a class="headerlink" href="#creating-custom-views" title="Lien vers cette rubrique"></a></h2>
<p>Il est possible de créer des vues personnalisées et de les ajouter au modèle de données.</p>
<p>Afin de permettre les mises à niveau du modèle de données, un script de création et un script de suppression de la vue doivent être fournis. Ces scripts (SQL ou Python) doivent être placés dans un endroit spécifique et être nommés pre-all.{py,sql} et post-all.{py,sql}. Le chemin sera donné comme paramètre à PUM lors de la mise à niveau  (voir PUM <a class="reference external" href="https://github.com/opengisch/pum">documentation</a>).</p>
<p>Si quelqu’un souhaite avoir ces vues mises à jour automatiquement lors d’une mise à jour du modèle, Pirogue peut être utilisé dynamiquement pour générer les vues. L’exemple de création des vues dans le modèle peut être utilisé.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="../interlis-io/index.html" class="btn btn-neutral float-left" title="4.4. Échange de données INTERLIS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="../datamodel-tool/index.html" class="btn btn-neutral float-right" title="4.6. Data model tool" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2024, The TWW Project www.teksi.ch.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>