<!DOCTYPE html>
<html class="writer-html5" lang="de" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.5. Customization of the data model &mdash; TWW dev Dokumentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=419ed147"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/translations.js?v=70a09b52"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../../genindex.html" />
    <link rel="search" title="Suche" href="../../search.html" />
    <link rel="next" title="4.6. Data-model tool" href="../datamodel-tool/index.html" />
    <link rel="prev" title="4.4. INTERLIS Data exchange" href="../interlis-io/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TWW
          </a>
              <div class="version">
                dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Dokumentation durchsuchen" aria-label="Dokumentation durchsuchen" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../features-guide/index.html">1. TEKSI wastewater module (TWW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation-guide/index.html">2. TWW Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">3. TWW User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">4. Admin Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../datamodel.html">4.1. Datamodel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pgadmin/index.html">4.2. pgAdmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">4.3. User Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interlis-io/index.html">4.4. INTERLIS Data exchange</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.5. Customization of the data model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.5.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-fields">4.5.2. Adding fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joining-additional-tables">4.5.3. Joining additional tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-views">4.5.4. Creating custom views</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../datamodel-tool/index.html">4.6. Data-model tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db-update-pum/index.html">4.7. Manual update of the datamodel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">5. Demo Virtual Machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tww_swmm/index.html">6. SWMM Data Exchange</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation/index.html">7. Translation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TWW</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">4. </span>Admin Guide</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4.5. </span>Customization of the data model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/admin-guide/db-customization/index.rst.txt" rel="nofollow"> Quelltext anzeigen</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="customization-of-the-data-model">
<h1><span class="section-number">4.5. </span>Customization of the data model<a class="headerlink" href="#customization-of-the-data-model" title="Link to this heading"></a></h1>
<p>This chapter describes the possible customization to the data model.</p>
<section id="introduction">
<h2><span class="section-number">4.5.1. </span>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>The data model is versioned and updates are achieved using Postgres Updates Manager (aka <a class="reference external" href="https://github.com/opengisch/pum">PUM</a>).
The views required to edit the data are automatically generated using <a class="reference external" href="https://github.com/opengisch/pirogue">Pirogue</a> library.</p>
<p>The combination of both allows to introduce small customizations of the data model such as adding fields to existing base tables or extending views by joining additional tables.</p>
<p>Before going further, we strongly recommend to ask the community if you have any doubts about how to store any information in the database. TWW complies with <a class="reference external" href="http://www.sia.ch/405">SIA 405</a> Waste Water and <a class="reference external" href="http://dss.vsa.ch">VSA-DSS</a> datamodel.</p>
<p>If TWW data model is not able yet to hold some data, please let us know what kind and how it should be handled. TWW data model is a standard proof adaptative model and could follow your needs.</p>
<p>If a customization is still required, the following explanations and rules explain how to adapt TWW data model to your specific needs.</p>
</section>
<section id="adding-fields">
<h2><span class="section-number">4.5.2. </span>Adding fields<a class="headerlink" href="#adding-fields" title="Link to this heading"></a></h2>
<p>It is allowed to add additional fields to tables by naming them as <code class="docutils literal notranslate"><span class="pre">usr_…</span></code>.</p>
<p>If added in base tables, these additional fields will be automatically added to the views, being an editable field. The views can be re-generated any time using the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_tww</span> <span class="pre">--srid</span> <span class="pre">2056</span></code></p>
<div class="admonition note">
<p class="admonition-title">Bemerkung</p>
<p>When running data model upgrades using PUM, it will be required to use the additional option <code class="docutils literal notranslate"><span class="pre">--exclude-field-pattern</span> <span class="pre">'usr_%'</span></code></p>
</div>
</section>
<section id="joining-additional-tables">
<h2><span class="section-number">4.5.3. </span>Joining additional tables<a class="headerlink" href="#joining-additional-tables" title="Link to this heading"></a></h2>
<p>It is possible to join additional tables to the two main views (<code class="docutils literal notranslate"><span class="pre">vw_tww_wastewater_structure</span></code> and <code class="docutils literal notranslate"><span class="pre">vw_tww_reach</span></code>).
This is done by using a YAML definition file for each view and defining a list of joined tables.
Fields of these tables will be joined as read-only fields as they are discarded in edit triggers.
For joining a table to <code class="docutils literal notranslate"><span class="pre">tww_od.wastewater_structure</span></code>, here is an example:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">joins</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my_extra_join</span><span class="p">:</span>
<span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tww_od.my_table</span>
<span class="w">    </span><span class="nt">alias</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mt</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mt_</span>
<span class="w">    </span><span class="nt">skip_columns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">field_1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">field_2</span>
<span class="w">    </span><span class="nt">remap_columns</span><span class="p">:</span>
<span class="w">      </span><span class="nt">field_3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_renamed_field</span>
<span class="w">    </span><span class="nt">join_on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mt.fk_ws = ws.obj_id</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">table</span></code> and <code class="docutils literal notranslate"><span class="pre">join_on</span></code> are mandatory keys, all the others are optional.</p>
<p>This YAML file should be given as a file path when running the script:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_tww</span> <span class="pre">--srid</span> <span class="pre">2056</span> <span class="pre">--tww_wastewater_structure_extra</span> <span class="pre">/path_to/extra_ws.yaml</span></code></p>
<p>And similarly for <code class="docutils literal notranslate"><span class="pre">vw_tww_reach</span></code> view, by specifying <code class="docutils literal notranslate"><span class="pre">tww_reach_extra</span></code> variable to the corresponding YAML file path.</p>
</section>
<section id="creating-custom-views">
<h2><span class="section-number">4.5.4. </span>Creating custom views<a class="headerlink" href="#creating-custom-views" title="Link to this heading"></a></h2>
<p>It is possible to create custom views and add them to the data model.</p>
<p>In order to allow upgrades of the data model, one should provide a script to create them and one to delete them.
These scripts (SQL or Python) should be placed in a specific path and name them as pre-all.{py,sql} and post-all.{py,sql}.
This path shall be given as argument to PUM when upgrading the data model as a delta directory (see PUM <a class="reference external" href="https://github.com/opengisch/pum">documentation</a>).</p>
<p>If one wants to have these views automatically updated when fields are added the data model, Pirogue can be used to dynamically generate the views. You can take example of the creation of the views in the data model.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../interlis-io/index.html" class="btn btn-neutral float-left" title="4.4. INTERLIS Data exchange" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Zurück</a>
        <a href="../datamodel-tool/index.html" class="btn btn-neutral float-right" title="4.6. Data-model tool" accesskey="n" rel="next">Weiter <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The TWW Project www.teksi.ch.</p>
  </div>

  Erstellt mit <a href="https://www.sphinx-doc.org/">Sphinx</a> mit einem
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    bereitgestellt von <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>