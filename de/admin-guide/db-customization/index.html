<!DOCTYPE html>
<html class="writer-html5" lang="de" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.5. Anpassung des Datenmodells &mdash; TWW dev Dokumentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=419ed147"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/translations.js?v=79cc9f76"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../../genindex.html" />
    <link rel="search" title="Suche" href="../../search.html" />
    <link rel="next" title="4.6. Datenmodell-Werkzeug" href="../datamodel-tool/index.html" />
    <link rel="prev" title="4.4. INTERLIS Datenaustausch" href="../interlis-io/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TWW
          </a>
              <div class="version">
                dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Dokumentation durchsuchen" aria-label="Dokumentation durchsuchen" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../features-guide/index.html">1. TEKSI Abwasser (TWW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation-guide/index.html">2. TWW Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">3. TWW Benutzerhandbuch</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">4. Administratorhandbuch</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../datamodel.html">4.1. Datenmodell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pgadmin/index.html">4.2. pgAdmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">4.3. User Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interlis-io/index.html">4.4. INTERLIS Datenaustausch</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.5. Anpassung des Datenmodells</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.5.1. Einleitung</a></li>
<li class="toctree-l3"><a class="reference internal" href="#altering-symbology-and-labelling-behaviour">4.5.2. Symbologie- und Beschriftungsverhalten ändern</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-fields">4.5.3. Zusätzliche Felder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joining-additional-tables">4.5.4. Verknüpfung zusätzlicher Tabellen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-views">4.5.5. Eigene views erstellen</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../datamodel-tool/index.html">4.6. Datenmodell-Werkzeug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db-update-pum/index.html">4.7. Manuelles Update des Datenmodells</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extensions-guide/index.html">5. Official TWW extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tww_swmm/index.html">6. SWMM Data Exchange</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation/index.html">7. Übersetzungen</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TWW</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">4. </span>Administratorhandbuch</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4.5. </span>Anpassung des Datenmodells</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/admin-guide/db-customization/index.rst.txt" rel="nofollow"> Quelltext anzeigen</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div></div></blockquote>
<section id="customization-of-the-data-model">
<h1><span class="section-number">4.5. </span>Anpassung des Datenmodells<a class="headerlink" href="#customization-of-the-data-model" title="Link to this heading"></a></h1>
<p>Dieses Kapitel beschreibt die möglichen Anpassungen des Datenmodells.</p>
<section id="introduction">
<h2><span class="section-number">4.5.1. </span>Einleitung<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>Das Datenmodell ist versioniert und Aktualisierungen werden mit dem Postgres Updates Manager (auch bekannt als <a class="reference external" href="https://github.com/opengisch/pum">PUM</a>) durchgeführt. Die zur Bearbeitung der Daten erforderlichen Ansichten werden automatisch mit der Bibliothek „Pirogue &lt;<a class="reference external" href="https://github.com/opengisch/pirogue">https://github.com/opengisch/pirogue</a>&gt;“ erzeugt.</p>
<p>Die Kombination von beidem ermöglicht kleine Anpassungen des Datenmodells, wie das Hinzufügen von Feldern zu bestehenden Basistabellen oder die Erweiterung von Ansichten durch das Verbinden zusätzlicher Tabellen.</p>
<p>Bevor Sie fortfahren, empfehlen wir Ihnen dringend, die Community zu fragen, wenn Sie irgendwelche Fragen haben, wie Sie Informationen in der Datenbank speichern können. QGEP erfüllt die Anforderungen der SIA 405 &lt;<a class="reference external" href="http://www.sia.ch/405">http://www.sia.ch/405</a>&gt;`_ Abwasser und des VSA-DSS &lt;<a class="reference external" href="http://dss.vsa.ch">http://dss.vsa.ch</a>&gt;`_ Datenmodells.</p>
<p>Wenn das TWW-Datenmodell noch nicht in der Lage ist, bestimmte Daten zu speichern, teilen Sie uns bitte mit, um welche Art von Daten es sich handelt und wie sie behandelt werden sollen. Das TWW-Datenmodell ist ein standardisiertes, anpassungsfähiges Modell welches viele ihrer Anforderung bereits abdeckt.</p>
<p>Sollte dennoch eine Anpassung erforderlich sein, erklären die folgenden Erläuterungen und Regeln, wie Sie das TWW-Datenmodell an Ihre spezifischen Bedürfnisse anpassen können.</p>
</section>
<section id="altering-symbology-and-labelling-behaviour">
<h2><span class="section-number">4.5.2. </span>Symbologie- und Beschriftungsverhalten ändern<a class="headerlink" href="#altering-symbology-and-labelling-behaviour" title="Link to this heading"></a></h2>
<p>Symbology and labelling behaviour depends on the value lists `` tww_vl.channel_usage_current`` and `` tww_vl.channel_function_hierarchic``  These two value list tables have an additional column <code class="docutils literal notranslate"><span class="pre">tww_symbology_order</span></code>, which is used to define the hierarchy of the symbology.</p>
<p>Für die Beschriftung kann die Spalte `` tww_vl.channel_function_hierarchic.tww_use_in_labels`` genutzt werden,  um zu steuern, welche FunktionHierarchisch beim Generieren des Labels berücksichtigt werden.</p>
</section>
<section id="adding-fields">
<h2><span class="section-number">4.5.3. </span>Zusätzliche Felder<a class="headerlink" href="#adding-fields" title="Link to this heading"></a></h2>
<p>Es ist erlaubt, zusätzliche Felder zu Tabellen hinzuzufügen, indem man sie als <code class="docutils literal notranslate"><span class="pre">usr_...</span></code> benennt.</p>
<p>Wenn sie in Basistabellen hinzugefügt werden, werden diese zusätzlichen Felder automatisch zu den Ansichten hinzugefügt, da es sich um ein bearbeitbares Feld handelt. Die Ansichten können jederzeit mit dem folgenden Befehl neu generiert werden:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_tww</span> <span class="pre">--srid</span> <span class="pre">2056</span></code></p>
<div class="admonition note">
<p class="admonition-title">Bemerkung</p>
<p>Wenn Datenmodell-Upgrades unter Verwendung von PUM durchgeführt werden, ist es erforderlich, die zusätzliche Option <code class="docutils literal notranslate"><span class="pre">--exclude-field-pattern</span> <span class="pre">'usr_%'</span></code> zu verwenden.</p>
</div>
</section>
<section id="joining-additional-tables">
<h2><span class="section-number">4.5.4. </span>Verknüpfung zusätzlicher Tabellen<a class="headerlink" href="#joining-additional-tables" title="Link to this heading"></a></h2>
<p>It is possible to join additional tables to the two main views (<code class="docutils literal notranslate"><span class="pre">vw_tww_wastewater_structure</span></code> and <code class="docutils literal notranslate"><span class="pre">vw_tww_reach</span></code>).
This is done by using a YAML definition file for each view and defining a list of joined tables.
Fields of these tables will be joined as read-only fields as they are discarded in edit triggers.
For joining a table to <code class="docutils literal notranslate"><span class="pre">tww_od.wastewater_structure</span></code>, here is an example:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">joins</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my_extra_join</span><span class="p">:</span>
<span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tww_od.my_table</span>
<span class="w">    </span><span class="nt">alias</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mt</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mt_</span>
<span class="w">    </span><span class="nt">skip_columns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">field_1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">field_2</span>
<span class="w">    </span><span class="nt">remap_columns</span><span class="p">:</span>
<span class="w">      </span><span class="nt">field_3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_renamed_field</span>
<span class="w">    </span><span class="nt">join_on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mt.fk_ws = ws.obj_id</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">table</span></code> und <code class="docutils literal notranslate"><span class="pre">join_on</span></code> sind Pflichtschlüssel, alle anderen sind optional.</p>
<p>Diese YAML-Datei sollte beim Ausführen des Skripts als Dateipfad angegeben werden:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_tww</span> <span class="pre">--srid</span> <span class="pre">2056</span> <span class="pre">--tww_wastewater_structure_extra</span> <span class="pre">/path_to/extra_ws.yaml</span></code></p>
<p>And similarly for <code class="docutils literal notranslate"><span class="pre">vw_tww_reach</span></code> view, by specifying <code class="docutils literal notranslate"><span class="pre">tww_reach_extra</span></code> variable to the corresponding YAML file path.</p>
</section>
<section id="creating-custom-views">
<h2><span class="section-number">4.5.5. </span>Eigene views erstellen<a class="headerlink" href="#creating-custom-views" title="Link to this heading"></a></h2>
<p>Es sit möglich, eigene views zu erstellen und sie zum Datenmodell zu hinzuzufügen.</p>
<p>Um Upgrades des Datenmodells zu ermöglichen, sollte man ein Skript bereitstellen, um sie zu erstellen, und eines, um sie zu löschen. Diese Skripte (SQL oder Python) sollten in einem bestimmten Pfad abgelegt und als pre-all.{py,sql} und post-all.{py,sql} bezeichnet werden. Dieser Pfad muss als Variable an PUM übergeben werden, wenn das Datenmodell als Delta-Verzeichnis aktualisiert wird (siehe PUM-<a class="reference external" href="https://github.com/opengisch/pum">Dokumentation</a>).</p>
<p>If one wants to have these views automatically updated when fields are added the data model, Pirogue can be used to dynamically generate the views. You can take example of the creation of the views in the data model.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../interlis-io/index.html" class="btn btn-neutral float-left" title="4.4. INTERLIS Datenaustausch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Zurück</a>
        <a href="../datamodel-tool/index.html" class="btn btn-neutral float-right" title="4.6. Datenmodell-Werkzeug" accesskey="n" rel="next">Weiter <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, The TWW Project www.teksi.ch.</p>
  </div>

  Erstellt mit <a href="https://www.sphinx-doc.org/">Sphinx</a> mit einem
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    bereitgestellt von <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>